<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Форма ввода</title>
  <link rel="stylesheet" type="text/css" href="styles.css">
  <style>
    .error {
      border: 2px solid red;
    }
  </style>
  <!-- Include flatpickr CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>
<body>
<form enctype="multipart/form-data">
  <div>
    <label for="hvsQuantity">Количество ХВС</label>
    <select id="hvsQuantity" name="hvsQuantity">
      <option value="0">0</option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
      <option value="7">7</option>
      <option value="8">8</option>
      <option value="9">9</option>
      <option value="10">10</option>
    </select>
  </div>

  <div>
    <label for="gvsQuantity">Количество ГВС</label>
    <select id="gvsQuantity" name="gvsQuantity">
      <option value="0">0</option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
      <option value="7">7</option>
      <option value="8">8</option>
      <option value="9">9</option>
      <option value="10">10</option>
    </select>
  </div>

  <div>
    <label for="totalAmount">Сумма</label>
    <input type="text" id="totalAmount" name="totalAmount" placeholder="Сумма">
  </div>

  <div>
    <label for="phone">Телефон</label>
    <input type="text" id="phone" inputmode="numeric" name="phone" placeholder="Телефон" value="+7">
  </div>

  <div>
    <input type="checkbox" id="copyPhoneCheckbox" name="copyPhoneCheckbox">
    <label for="copyPhoneCheckbox">Скопировать телефон</label>
  </div>

  <div>
    <label for="contactNumber">Номер телефона звонящего</label>
    <input type="text" id="contactNumber" inputmode="numeric" name="contactNumber" placeholder="Номер телефона звонящего" value="+7">
  </div>

  <div>
    <label for="city">Город</label>
    <select id="city" name="city">
      <option selected></option>
    </select>
  </div>
  <div>
    <label for="district">Район</label>
    <select id="district" name="district">
      <option value="ЦАО" selected></option>
    </select>
  </div>

  <div>
    <label for="street">Улица</label>
    <input type="text" id="street" name="street" placeholder="Улица">
  </div>

  <div>
    <label for="house">Дом</label>
    <input type="text" id="house" name="house" placeholder="Дом">
  </div>

  <div>
    <label for="building">Корпус</label>
    <input type="text" id="building" name="building" placeholder="Корпус">
  </div>

  <div>
    <label for="apartment">Квартира</label>
    <input type="text" id="apartment" name="apartment" placeholder="Квартира">
  </div>

  <div>
    <label for="entrance">Подъезд</label>
    <input type="text" id="entrance" name="entrance" placeholder="Подъезд">
  </div>

  <div>
    <label for="floor">Этаж</label>
    <input type="text" id="floor" name="floor" placeholder="Этаж">
  </div>

  <div>
    <label for="intercomCode">Код домофона</label>
    <input type="text" id="intercomCode" name="intercomCode" placeholder="Код домофона">
  </div>

  <div>
    <label for="workDate">Дата проведения работ</label>
    <input type="text" id="workDate" name="workDate" placeholder="Дата проведения работ">
  </div>

  <div>
    <label for="workInterval">Временной интервал работ</label>
    <select id="workInterval" name="workInterval">
      <option value="8:00 - 10:00">8:00 - 10:00</option>
      <option value="10:00 - 12:00">10:00 - 12:00</option>
      <option value="12:00 - 14:00">12:00 - 14:00</option>
      <option value="14:00 - 16:00">14:00 - 16:00</option>
      <option value="16:00 - 18:00">16:00 - 18:00</option>
      <option value="18:00 - 20:00">18:00 - 20:00</option>
      <option value="20:00 - 22:00">20:00 - 22:00</option>
    </select>
  </div>
  <div>
    <label for="notes">Примечания</label>
    <textarea id="notes" name="notes" placeholder="Примечания"></textarea>
  </div>
  <div id="error"></div>
  <div class="button-group">
    <button type="submit" id="submit">Создать заявку</button>
    <button type="reset" id="reset" style="margin-left: 10px">Отмена</button>
  </div>
</form>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
  function loadJSONFile(file, callback) {
    var xhr = new XMLHttpRequest();
    xhr.overrideMimeType('application/json');
    xhr.open('GET', file, true);
    xhr.onreadystatechange = function () {
      if (xhr.readyState === 4 && xhr.status === 200) {
        callback(xhr.responseText);
      }
    };
    xhr.send(null);
  }

  function loadCities() {
    var citySelect = document.getElementById('city');
    loadJSONFile('all_city.json', function (response) {
      var cities = JSON.parse(response);
      cities.forEach(function (city) {
        var option = document.createElement('option');
        option.value = city.city;
        option.textContent = city.city;
        citySelect.appendChild(option);
      });
    });
  }

  function loadDistricts() {
    var citySelect = document.getElementById('city');
    var districtSelect = document.getElementById('district');
    citySelect.addEventListener('change', function () {
      var selectedCity = citySelect.value;
      districtSelect.innerHTML = '';
      loadJSONFile('all_city.json', function (response) {
        var cities = JSON.parse(response);
        var selectedCityData = cities.find(function (city) {
          return city.city === selectedCity;
        });
        if (selectedCityData && selectedCityData.raion) {
          selectedCityData.raion.forEach(function (raion) {
            var option = document.createElement('option');
            option.value = raion;
            option.textContent = raion;
            districtSelect.appendChild(option);
          });
        }
      });
    });
  }

  loadCities();
  loadDistricts();

  // Получаем ссылки на поля ввода "Телефон" и "Номер телефона звонящего"
  const phoneInput = document.getElementById('phone');
  const contactNumberInput = document.getElementById('contactNumber');

  // Получаем ссылку на чекбокс "Скопировать телефон"
  const copyPhoneCheckbox = document.getElementById('copyPhoneCheckbox');

  // Добавляем обработчик события изменения состояния чекбокса
  copyPhoneCheckbox.addEventListener('change', function() {
    if (copyPhoneCheckbox.checked) {
      // Если чекбокс выбран, копируем значение из поля "Телефон" в поле "Номер телефона звонящего"
      contactNumberInput.value = phoneInput.value;
    } else {
      // Если чекбокс не выбран, очищаем поле "Номер телефона звонящего"
      contactNumberInput.value = '';
    }
  });

  // Инициализируем flatpickr для поля "Дата проведения работ"
  const workDateInput = document.getElementById('workDate');
  flatpickr(workDateInput, {
    enableTime: false,
    dateFormat: 'd.m.Y',
    minDate: 'today',
    locale: {
      months: {
        shorthand: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн', 'Июл', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек'],
        longhand: ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь']
      },
      weekdays: {
        shorthand: ['Вс', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'],
        longhand: ['Воскресенье', 'Понедельник', 'Вторник', 'Среда', 'Четверг', 'Пятница', 'Суббота']
      }
    }
  });

  // Получаем все поля ввода текста и текстовые области
  const inputFields = Array.from(document.querySelectorAll('input[type="text"], textarea'));

  // Добавляем обработчик события нажатия клавиши для каждого поля ввода
  inputFields.forEach((input, index) => {
    input.addEventListener('keydown', (event) => {
      if (event.key === 'Enter') {
        event.preventDefault();
        // Устанавливаем фокус на следующее поле ввода, если оно существует
        const nextIndex = index + 1;
        if (nextIndex < inputFields.length) {
          inputFields[nextIndex].focus();
          inputFields[nextIndex].setSelectionRange(inputFields[nextIndex].value.length, inputFields[nextIndex].value.length);
        }
      }
    });
  });
</script>
</body>
</html>
